@page "/exercise"
@page "/exercise/{ExerciseId:int}"
@page "/exercise/{ExerciseId:int}/{Detail?}"
@rendermode InteractiveServer
@using Therapeasy.Model
@using Microsoft.AspNetCore.Authorization
@using System.Net.Http.Json
@using System.Text.Json
@using System.Text
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager

<AuthorizeView Roles="Therapist,Admin" Context="authContext">
  <button class="btn-primary" @onclick=@(e => IsEdit = !IsEdit)>@(IsEdit ? "View Exercise" : "Edit Exercise")</button>
</AuthorizeView>
@if (IsEdit) {
  <EditExercise ExerciseId=@ExerciseId Detail=@Detail />
} else {
  <ViewExercise ExerciseId=@ExerciseId Detail=@Detail />
}
<ThisExerciseImage ExerciseId=@ExerciseId />

@code {
    [Parameter]
    public int ExerciseId { get; set; }
    [Parameter]
    public string Detail { get; set; } = "nodetail";
    private bool IsEdit = false;
    public string Username { get; set; } = "";
    Exercise exercise = new Exercise();
    List<ExerciseImage> exerciseImages = new();

    protected override async Task OnInitializedAsync()
    {
        if (ExerciseId > 0)
        {
          var result = await HttpClient.GetFromJsonAsync<Exercise>(NavigationManager.BaseUri + "plandb/get/exercisefromid/" + ExerciseId);
          if (result != null)
          {
              exercise = result;
          }
        }
    }
}