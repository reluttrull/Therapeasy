@page "/viewexercise"
@page "/viewexercise/{ExerciseId:int}"
@page "/viewexercise/{ExerciseId:int}/{Detail?}"
@rendermode InteractiveServer
@using Therapeasy.Model
@using Microsoft.AspNetCore.Authorization
@using System.Net.Http.Json
@using System.Text.Json
@using System.Text
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager

<AuthorizeView Roles="Admin,Therapist,Patient" Context="authContext">
    @if (exercise != null)
    {
        <h5><a class="link" href="/exercise/@ExerciseId/detailed">@exercise.Name</a></h5>
        <p>- added on @exercise.GetFormattedDateAdded() by @exercise.CreatedByUser</p>
        @if (Detail == "detailed")
        {
            <p>@exercise.GetFormattedSetsAndReps()</p>
            @if (exercise.Notes.Length > 1) {<p>Notes: @exercise.Notes</p>}
        }
    }
</AuthorizeView>

@code {
    [Parameter]
    public int ExerciseId { get; set; }
    [Parameter]
    public string Detail { get; set; } = "nodetail";
    public string Username { get; set; } = "";
    Exercise exercise = new Exercise();
    List<ExerciseImage> exerciseImages = new();

    protected override async Task OnInitializedAsync()
    {
        if (ExerciseId > 0)
        {
          var result = await HttpClient.GetFromJsonAsync<Exercise>(NavigationManager.BaseUri + "plandb/get/exercisefromid/" + ExerciseId);
          if (result != null)
          {
              exercise = result;
          }
        }
    }
}